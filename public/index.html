<!DOCTYPE html>
<html lang="es">
<head>
  <!-- ========================= -->
  <!-- CONFIGURACIÓN BÁSICA -->
  <!-- ========================= -->
  <meta charset="UTF-8">
  <title>Asistente Académico ESPOCH</title>

  <!-- Tipografía moderna y limpia -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    /* ========================= */
    /* VARIABLES DE COLOR */
    /* ========================= */
    :root {
      --azul-oscuro: #0a2a43;
      --azul-medio: #103a5c;
      --rojo: #8b1e2d;
      --blanco: #ffffff;
      --gris-texto: #1f2937;
    }

    /* ========================= */
    /* CONFIGURACIÓN GLOBAL */
    /* ========================= */
    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(135deg, var(--azul-oscuro), var(--azul-medio));
      color: var(--blanco);
      display: flex;
      flex-direction: column;
    }

    /* ========================= */
    /* HEADER SUPERIOR */
    /* ========================= */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 40px;
    }

    header h1 {
      font-size: 24px;
      margin: 0;
    }

    nav a {
      color: var(--blanco);
      text-decoration: none;
      margin: 0 15px;
      font-weight: 500;
    }

    /* ========================= */
    /* CONTENEDOR PRINCIPAL */
    /* ========================= */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    /* Avatar del chatbot */
    .avatar {
      width: 100px;
      height: 100px;
      background: var(--blanco);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }

    .avatar img {
      width: 70px;
    }

    h2 {
      font-size: 34px;
      margin: 10px 0;
    }

    .subtitle {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 20px;
    }

    /* ========================= */
    /* CONTENEDOR DEL CHAT */
    /* ========================= */
    #chat {
      width: 70%;
      max-width: 900px;
      height: 45vh;              /* Altura adaptable */
      min-height: 350px;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(12px);
      border-radius: 18px;
      padding: 20px;
      overflow-y: auto;
      text-align: left;
      margin-bottom: 18px;
    }

    /* ========================= */
    /* MENSAJES */
    /* ========================= */
    .msg {
      margin-bottom: 14px;
      padding: 14px 18px;
      border-radius: 14px;
      max-width: 75%;
      line-height: 1.6;         /* Mejora lectura */
      font-size: 15px;
      word-wrap: break-word;
    }

    /* Mensaje del usuario */
    .user {
      background: linear-gradient(135deg, #0b5ed7, #084298);
      color: white;
      margin-left: auto;
    }

    /* Mensaje del bot */
    .bot {
      background: #ffffff;
      color: var(--gris-texto);
    }

    /* Error */
    .error {
      background: #dc3545;
      color: white;
    }

    /* ========================= */
    /* INPUT DE MENSAJE */
    /* ========================= */
    .input-wrapper {
      width: 70%;
      max-width: 900px;
      background: var(--blanco);
      border-radius: 50px;
      display: flex;
      align-items: center;
      padding: 10px 20px;
    }

    .input-wrapper input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 16px;
    }

    .input-wrapper button {
      background: var(--rojo);
      color: var(--blanco);
      border: none;
      width: 46px;
      height: 46px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
    }

    /* ========================= */
    /* FOOTER */
    /* ========================= */
    footer {
      text-align: center;
      font-size: 13px;
      opacity: 0.7;
      padding: 12px 0;
    }

    /* ========================= */
    /* RESPONSIVE (MÓVIL) */
    /* ========================= */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        gap: 10px;
        padding: 15px;
      }

      nav {
        display: none;
      }

      h2 {
        font-size: 26px;
      }

      #chat,
      .input-wrapper {
        width: 92%;
      }
    }
  </style>
</head>

<body>

  <!-- ========================= -->
  <!-- HEADER -->
  <!-- ========================= -->
  <header>
    <h1>ESPOCH · Asistente Académico</h1>
    <nav>
      <a href="#">Inicio</a>
      <a href="#">Matrículas</a>
      <a href="#">Contacto</a>
    </nav>
  </header>

  <!-- ========================= -->
  <!-- CONTENIDO PRINCIPAL -->
  <!-- ========================= -->
  <main>
    <div class="avatar">
      <img src="https://cdn-icons-png.flaticon.com/512/4712/4712109.png" alt="Chatbot">
    </div>

    <h2>¿En qué puedo ayudarte?</h2>
    <div class="subtitle">
      Consultas sobre matrículas, requisitos y procesos académicos
    </div>

    <!-- HISTORIAL DEL CHAT -->
    <div id="chat"></div>

    <!-- INPUT -->
    <div class="input-wrapper">
      <input id="userInput" type="text" placeholder="Escribe tu consulta aquí...">
      <button onclick="sendMessage()">➤</button>
    </div>
  </main>

  <!-- ========================= -->
  <!-- FOOTER -->
  <!-- ========================= -->
  <footer>
    Escuela Superior Politécnica de Chimborazo · Sede Orellana
  </footer>

  <!-- ========================= -->
  <!-- JAVASCRIPT -->
  <!-- ========================= -->
  <script>
    const chat = document.getElementById("chat");
    const input = document.getElementById("userInput");

    // Función principal para enviar mensaje
    async function sendMessage() {
      const message = input.value.trim();
      if (!message) return;

      // Mostrar mensaje del usuario
      chat.innerHTML += `
        <div class="msg user">
          <strong>Tú:</strong> ${message}
        </div>
      `;
      chat.scrollTop = chat.scrollHeight;
      input.value = "";

      try {
        // Llamada a la API de Dialogflow (Vercel)
        const response = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message })
        });

        if (!response.ok) throw new Error("Error de servidor");

        const data = await response.json();

        // Mostrar respuesta del bot
        chat.innerHTML += `
          <div class="msg bot">
            <strong>Chatbot:</strong><br>${data.reply.replace(/\n/g, "<br>")}
          </div>
        `;
        chat.scrollTop = chat.scrollHeight;

      } catch (error) {
        // Mostrar error
        chat.innerHTML += `
          <div class="msg error">
            ❌ Error al conectar con el servidor
          </div>
        `;
      }
    }

    // Enviar con ENTER
    input.addEventListener("keydown", function(e) {
      if (e.key === "Enter") sendMessage();
    });
  </script>

</body>
</html>
